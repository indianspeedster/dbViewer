<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Table: {{ table }}</title>
  <style>
    :root {
      --bg: #f5f7fa;
      --fg: #2c3e50;
      --table-bg: white;
      --row-alt: #f2f2f2;
      --row-hover: #e0f0ff;
      --header-bg: #3498db;
      --header-fg: white;
      --accent: #2ecc71;
    }

    body.dark {
      --bg: #1e1e2f;
      --fg: #f5f5f5;
      --table-bg: #2e2e3e;
      --row-alt: #3a3a4a;
      --row-hover: #404052;
      --header-bg: #2c3e50;
      --header-fg: #f5f5f5;
      --accent: #27ae60;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--bg);
      color: var(--fg);
      padding: 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h2 {
      margin-bottom: 20px;
    }

    .toolbar {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      width: 100%;
      max-width: 1000px;
      margin-bottom: 20px;
    }

    .toolbar input {
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      min-width: 200px;
    }

    .toolbar button {
      padding: 8px 16px;
      background-color: var(--accent);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-left: 10px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 1000px;
      background-color: var(--table-bg);
      border-radius: 8px;
      overflow: hidden;
      margin-top: 10px;
    }

    th, td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    th {
      background-color: var(--header-bg);
      color: var(--header-fg);
      cursor: pointer;
    }

    tr:nth-child(even) {
      background-color: var(--row-alt);
    }

    tr:hover {
      background-color: var(--row-hover);
    }

    .pagination {
      margin-top: 20px;
    }

    .pagination button {
      padding: 6px 12px;
      margin: 0 4px;
      background: var(--header-bg);
      color: var(--header-fg);
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    a.button {
      margin-top: 25px;
      padding: 10px 20px;
      background-color: var(--accent);
      color: white;
      text-decoration: none;
      border-radius: 6px;
    }
  </style>
</head>
<body>

  <h2>ðŸ“„ Contents of <em>{{ table }}</em></h2>

  <div class="toolbar">
    <input type="text" id="search" placeholder="Search...">
    <div>
      <button onclick="toggleDarkMode()">ðŸŒ“ Toggle Dark Mode</button>
      <button onclick="downloadCSV()">â¬‡ Download CSV</button>
    </div>
  </div>

  <table id="data-table">
    <thead>
      <tr>
        {% for col in colnames %}
          <th onclick="sortTable({{ loop.index0 }})">{{ col }}</th>
        {% endfor %}
      </tr>
    </thead>
<tbody id="table-body">
  {% for row in zipped_rows %}
    <tr>
      {% for val, colname in row %}
        {% if table == "sessions" and colname == "url" %}
          <td><a href="{{ val }}" target="_blank">{{ val }}</a></td>
        {% else %}
          <td>{{ val }}</td>
        {% endif %}
      {% endfor %}
    </tr>
  {% endfor %}
</tbody>

  </table>

  <div class="pagination" id="pagination"></div>

  <a class="button" href="/">â¬… Back to Tables</a>

<script>
  let currentPage = 1;
  const rowsPerPage = 10;

  function getVisibleRows() {
    const filter = document.getElementById("search").value.toLowerCase();
    const allRows = Array.from(document.querySelectorAll("#table-body tr"));
    return allRows.filter(row =>
      Array.from(row.children).some(
        td => td.textContent.toLowerCase().includes(filter)
      )
    );
  }

  function updatePagination() {
    const rows = getVisibleRows();
    const totalPages = Math.ceil(rows.length / rowsPerPage);
    const pagDiv = document.getElementById("pagination");
    const allRows = Array.from(document.querySelectorAll("#table-body tr"));
    
    allRows.forEach(row => row.style.display = "none");

    rows.forEach((row, i) => {
      if (i >= (currentPage - 1) * rowsPerPage && i < currentPage * rowsPerPage) {
        row.style.display = "";
      }
    });

    pagDiv.innerHTML = "";
    for (let i = 1; i <= totalPages; i++) {
      const btn = document.createElement("button");
      btn.innerText = i;
      btn.onclick = () => {
        currentPage = i;
        updatePagination();
      };
      if (i === currentPage) btn.style.fontWeight = "bold";
      pagDiv.appendChild(btn);
    }
  }

  function sortTable(colIndex) {
    const rows = Array.from(document.querySelectorAll("#table-body tr"));
    rows.sort((a, b) => {
      const valA = a.children[colIndex].textContent.trim();
      const valB = b.children[colIndex].textContent.trim();
      return valA.localeCompare(valB, undefined, { numeric: true });
    });
    const tbody = document.getElementById("table-body");
    tbody.innerHTML = "";
    rows.forEach(row => tbody.appendChild(row));
    currentPage = 1;
    updatePagination();
  }

  document.getElementById("search").addEventListener("input", () => {
    currentPage = 1;
    updatePagination();
  });

  function toggleDarkMode() {
    document.body.classList.toggle("dark");
    localStorage.setItem("darkMode", document.body.classList.contains("dark"));
  }

  function downloadCSV() {
    const rows = getVisibleRows();  // filtered + sorted
    const headers = Array.from(document.querySelectorAll("table thead th")).map(th => `"${th.innerText}"`);
    const csvRows = [headers.join(",")];

    rows.forEach(row => {
      const values = Array.from(row.children).map(td => `"${td.innerText}"`);
      csvRows.push(values.join(","));
    });

    const blob = new Blob([csvRows.join("\n")], { type: 'text/csv' });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = document.title.replace(/[^a-zA-Z0-9]/g, "_") + ".csv";
    a.click();
  }

  // Restore dark mode on reload
  window.onload = () => {
    if (localStorage.getItem("darkMode") === "true") {
      document.body.classList.add("dark");
    }
    updatePagination();
  };
</script>


</body>
</html>
